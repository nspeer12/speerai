<head>
    <style>
      body { margin: 0; }
  
      #time-log {
        position: absolute;
        font-size: 12px;
        font-family: sans-serif;
        padding: 5px;
        border-radius: 3px;
        background-color: rgba(200, 200, 200, 0.1);
        color: lavender;
        bottom: 10px;
        right: 10px;
      }

      @media (max-width: 768px) {
        nav {
          min-height: 500px;
          height: auto; /* Adjust nav height for mobile responsiveness */
        }
        nav img {
          height: 50px; /* Adjust image height for mobile responsiveness */
        }
        nav button {
          padding: 5px 10px;
          font-size: 14px;
        }
      }
    </style>
  
    <script type="importmap">{ "imports": {
      "three": "//unpkg.com/three/build/three.module.js",
      "three/addons/": "//unpkg.com/three/examples/jsm/"
    }}</script>
    <script type="module">
      import * as THREE from 'three';
      window.THREE = THREE;
      
    </script>
  
    <!--  <script src="../../dist/three-globe.js" defer></script>-->
  
    <script src="//unpkg.com/satellite.js/dist/satellite.min.js"></script>
  </head>
  
  <body>
    <nav style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background-color: #000000; flex-wrap: wrap; height: auto;">
      <img src="public/img/nav.png" alt="Logo" style="height: 100px;">
<!-- Calendly link widget begin -->
<link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
<script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>
<button style="background-color: blue; color: white; border: none; padding: 10px 20px; text-align: center; text-decoration: none; display: inline-block; font-size: 16px; margin: 4px 2px; cursor: pointer; border-radius: 3px; transition: transform 0.3s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" onclick="Calendly.initPopupWidget({url: 'https://calendly.com/d/32h-xgt-vx9?hide_gdpr_banner=1&text_color=000000'});return false;">Contact</button>
<!-- Calendly link widget end -->
    </nav>
    <div id="globeViz"></div>
    <div id="time-log"></div>
  
    <script type="module">
        import ThreeGlobe from 'three-globe';
      import { TrackballControls } from 'three/addons/controls/TrackballControls.js';
  
      const EARTH_RADIUS_KM = 6371; // km
      const SAT_SIZE = 100; // km
      const TIME_STEP = 4 * 100; // per frame
  
      const timeLogger = document.getElementById('time-log');
  
      const Globe = new ThreeGlobe()
        .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
        .objectLat('lat')
        .objectLng('lng')
        .objectAltitude('alt')
        .objectFacesSurface(false);
  
      const satGeometry = new THREE.SphereGeometry(SAT_SIZE * Globe.getGlobeRadius() / EARTH_RADIUS_KM / 8, 32, 32);
      const satMaterial = new THREE.MeshPhongMaterial({ color: 'silver', specular: 0xaaaaaa, shininess: 100 });
      Globe.objectThreeObject(() => new THREE.Mesh(satGeometry, satMaterial));
  
      fetch('./space-track-leo.txt').then(r => r.text()).then(rawData => {
        const tleData = rawData.replace(/\r/g, '').split(/\n(?=[^12])/).map(tle => tle.split('\n'));
        const satData = tleData.map(([name, ...tle]) => ({
          satrec: satellite.twoline2satrec(...tle),
          name: name.trim().replace(/^0 /, '')
        }));
  
        // time ticker
        let time = new Date();
        (function frameTicker() {
          requestAnimationFrame(frameTicker);
  
          time = new Date(+time + TIME_STEP);
          timeLogger.innerText = time.toString();
  
          // Update satellite positions
          const gmst = satellite.gstime(time);
          satData.forEach(d => {
            const eci = satellite.propagate(d.satrec, time);
            if (eci.position) {
              const gdPos = satellite.eciToGeodetic(eci.position, gmst);
              d.lat = satellite.radiansToDegrees(gdPos.latitude);
              d.lng = satellite.radiansToDegrees(gdPos.longitude);
              d.alt = gdPos.height / EARTH_RADIUS_KM
            }
          });
  
          Globe.objectsData(satData);
        })();
      });
  
      //
  
      // Setup renderer
      const renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.getElementById('globeViz').appendChild(renderer.domElement);
  
      // Setup scene
      const scene = new THREE.Scene();
      scene.add(Globe);
      scene.add(new THREE.AmbientLight(0xcccccc, Math.PI));
      // Add unidirectional light
      const directionalLight = new THREE.DirectionalLight(0xffd700, 1);
      directionalLight.position.set(0, 0, 0);
      scene.add(directionalLight);
  
      // Setup camera
      const camera = new THREE.PerspectiveCamera();
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      // Adjust camera position based on device
      camera.position.z = window.innerWidth < 768 ? 1200 : 500; // Zoom out more on mobile
  
      // Add camera controls
      const tbControls = new TrackballControls(camera, renderer.domElement);
      tbControls.minDistance = 10;
      tbControls.rotateSpeed = 5;
      tbControls.zoomSpeed = 0.8;
  
      // Kick-off renderer
      (function animate() { // IIFE
        // Frame cycle
        tbControls.update();
        renderer.render(scene, camera);
        requestAnimationFrame(animate);
        // Rotate the Earth
        Globe.rotation.y += 0.001;
      })();
    </script>
  </body>